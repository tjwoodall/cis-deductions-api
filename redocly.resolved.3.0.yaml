openapi: 3.0.3
info:
  version: '3.0'
  title: CIS Deductions (MTD)
  description: |
    # Send fraud prevention data
    HMRC monitors transactions to help protect your customers' confidential data from criminals and fraudsters. 

    <div class="govuk-warning-text warning-icon-fix">
      <span class="govuk-warning-text__icon warning-icon-ui-fix" aria-hidden="true">!</span>
      <strong class="govuk-warning-text__text">
        <span class="govuk-warning-text__assistive">Warning</span>
        You are required by law to submit header data for this API. This includes all associated APIs and endpoints.
      </strong>
    </div>

    [Check the data you need to send](/guides/fraud-prevention/). You can also use the [Test API](/api-documentation/docs/api/service/txm-fph-validator-api/1.0) during initial development and as part of your quality assurance checks.

    # Mapping APIs to Self Assessment tax return forms
    Some parameters in this API map to box numbers in one or more Self Assessment tax return forms. To learn more and to download this mapping information as a CSV file, go to [income-tax-mtd-changelog/mapping](https://github.com/hmrc/income-tax-mtd-changelog?tab=readme-ov-file#mapping-apis-to-self-assessment-tax-return-forms) on GitHub.

    # Changelog
    You can find the changelog in the [income-tax-mtd-changelog](https://github.com/hmrc/income-tax-mtd-changelog/#readme) on GitHub.

    # Support

    * Direct reports of bugs or errors in Production or Sandbox code, or queries about HMRC business functionality (such as how a specific field is used by HMRC or why it is needed) to the [Software Development Support Team (SDST)](https://developer.service.hmrc.gov.uk/developer/support).
    * Send queries or feedback related to the design of the APIs (including recommended changes) using the [income-tax-mtd-changelog](https://github.com/hmrc/income-tax-mtd-changelog/issues) GitHub page.
    * <a href="/contact/report-technical-problem?newTab=true&service=api-documentation-frontend" target="_blank">Is this page not working properly? (opens in new tab)</a>
servers:
  - url: https://test-api.service.hmrc.gov.uk
    description: Sandbox
  - url: https://api.service.hmrc.gov.uk
    description: Production
paths:
  /individuals/deductions/cis/{nino}/current-position/{taxYear}/{source}:
    get:
      summary: Retrieve CIS Deductions for Subcontractor
      description: |
        This endpoint allows a developer to retrieve a customer's latest CIS deductions data and whether it was submitted by a contractor or user. A National Insurance number, tax year and source must be provided.

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario)                | Scenario                                                                                                                    |
        |-------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
        | N/A - DEFAULT                                   | Simulates success response with customer and contractor deductions.                                                         |
        | N/A - DEFAULT <br> using source **all**         | Simulates success response with customer and contractor deductions                                                          |
        | N/A - DEFAULT <br> using source **contractor**  | Simulates success response with contractor deductions.                                                                      |
        | N/A - DEFAULT <br> using source **customer**    | Simulates success response with customer deductions.                                                                        |
        | TAX_YEAR_RANGE_INVALID                          | Simulates the scenario where specified tax year is outside the allowable tax years (the current tax year minus four years). |
        | TAX_YEAR_NOT_SUPPORTED                          | Simulates the scenario where the tax year is not supported.                                                                 |
        | NOT_FOUND                                       | Simulates the scenario where no data is found.                                                                              |
        | DYNAMIC                                         | The following response values will change to correspond to the values submitted in the request: <br/> &bull; fromDate <br/> &bull; toDate <br/> &bull; deductionFromDate <br/> &bull; deductionToDate <br/> &bull; submissionDate <br/> &bull; source |
        | STATEFUL                                        | Performs a stateful retrieve.                                                                                               |
      parameters:
        - name: nino
          in: path
          description: |
            National Insurance number in the format AA999999A.
          schema: &ref_6
            type: string
            example: TC663795B
          required: true
        - name: taxYear
          in: path
          description: |
            The tax year the data applies to, for example, 2021-22. The start year and end year must not span two tax years.
          schema: &ref_28
            type: string
            example: 2021-22
          required: true
        - in: path
          name: source
          description: |
            The source of amended data. Defaults to `all`.
          schema:
            type: string
            enum:
              - all
              - contractor
              - customer
            example: all
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *read:self-assessment* scope.
          schema:
            type: string
            example: Bearer bb7fed3fe10dd235a2ccda3d50fb
          required: true
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: &ref_7
            type: string
            example: application/vnd.hmrc.3.0+json
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: &ref_8
            type: string
            example: '-'
          required: false
      security:
        - User-Restricted:
            - read:self-assessment
      responses:
        '200':
          description: Success
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: &ref_0
                type: string
                example: c75f40a6-a3df-4429-a697-471eeec46435
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: &ref_1
                type: string
                example: Sun, 01 Jan 2023 23:59:59 GMT
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: &ref_2
                type: string
                example: Sun, 02 Jul 2023 23:59:59 GMT
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: &ref_3
                type: string
                example: https://developer.service.hmrc.gov.uk/api-documentation/docs/api/service/cis-deductions-api
              required: false
          content:
            application/json:
              schema:
                $schema: http://json-schema.org/draft-04/schema#
                title: List CIS Deductions
                description: List CIS Deductions
                type: object
                properties:
                  totalDeductionAmount:
                    description: The total amount of tax deducted by CIS contractors. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                    type: number
                    example: '5000.99'
                  totalCostOfMaterials:
                    description: The total cost of materials incurred under CIS by the subcontractor across all of the CIS contractors that they worked for. This value must be between 0 and 99999999999.99 up to 2 decimal places.
                    type: number
                    example: '5000.99'
                  totalGrossAmountPaid:
                    description: The total gross amount paid by CIS contractors. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                    type: number
                    example: '5000.99'
                  cisDeductions:
                    description: List of the components that make up the overall deductions.
                    type: array
                    items:
                      title: item
                      type: object
                      properties:
                        fromDate:
                          description: CIS start date of a tax year.
                          type: string
                          example: '2020-04-06'
                        toDate:
                          description: CIS end date of a tax year.
                          type: string
                          example: '2021-04-05'
                        contractorName:
                          description: The name of the contractor the subcontractor worked for.
                          type: string
                          minimum: 1
                          maximum: 105
                        employerRef:
                          description: A unique identifier, the contractor reference number.
                          pattern: ^[0-9]{3}\/[^ ].{0,9}$
                          type: string
                          example: 123/AC80213
                        totalDeductionAmount:
                          description: The total amount of tax deducted by a CIS contractor. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                          type: number
                          example: '5000.99'
                        totalCostOfMaterials:
                          description: The total cost of materials incurred under CIS by the subcontractor. This value must be between 0 and 99999999999.99 up to 2 decimal places.
                          type: number
                          example: '5000.99'
                        totalGrossAmountPaid:
                          description: The total gross amount paid by a CIS contractor. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                          type: number
                          example: '5000.99'
                        periodData:
                          description: List of deductions.
                          type: array
                          items:
                            title: item
                            type: object
                            properties:
                              deductionFromDate:
                                description: The From date when the deduction was made within the CIS tax year period.
                                type: string
                                example: '2020-07-06'
                              deductionToDate:
                                description: The To date when the deduction was made within the CIS tax year period.
                                type: string
                                example: '2020-08-05'
                              deductionAmount:
                                description: The amount of tax deducted by the contractor. This value must be between 0 and 99999999999.99 up to 2 decimal places.
                                type: number
                                multipleOf: 0.01
                                minimum: 0
                                maximum: 99999999999.99
                                example: '5000.99'
                              costOfMaterials:
                                description: The cost of materials incurred under CIS. This value must be between 0 and 99999999999.99 up to 2 decimal places.
                                type: number
                                multipleOf: 0.01
                                minimum: 0
                                maximum: 99999999999.99
                                example: '50.00'
                              grossAmountPaid:
                                description: The gross amount paid under CIS. This value must be between 0 and 99999999999.99 up to 2 decimal places.
                                type: number
                                multipleOf: 0.01
                                minimum: 0
                                maximum: 99999999999.99
                                example: '5000.99'
                              submissionDate:
                                description: The date the deduction was submitted.
                                type: string
                                example: '2020-05-11T16:38:57Z'
                              submissionId:
                                description: The unique identifier for the submission.
                                type: string
                                example: 4557ecb5-fd32-48cc-81f5-e6acd1099f3c
                              source:
                                description: The source of the data.
                                type: string
                                example: customer or contractor
                            required:
                              - deductionFromDate
                              - deductionToDate
                              - submissionDate
                              - source
                      required:
                        - periodData
                        - fromDate
                        - toDate
                        - employerRef
                required:
                  - cisDeductions
              examples:
                example-response:
                  description: Example Response
                  value:
                    totalDeductionAmount: 12345.56
                    totalCostOfMaterials: 234234.33
                    totalGrossAmountPaid: 2342424.56
                    cisDeductions:
                      - fromDate: '2020-04-06'
                        toDate: '2021-04-05'
                        contractorName: contractor Name
                        employerRef: 123/AA12345
                        totalDeductionAmount: 3543.55
                        totalCostOfMaterials: 6644.67
                        totalGrossAmountPaid: 3424.12
                        periodData:
                          - deductionFromDate: '2020-04-06'
                            deductionToDate: '2020-05-05'
                            deductionAmount: 4654.78
                            costOfMaterials: 4564.89
                            grossAmountPaid: 7878.67
                            submissionDate: '2020-05-11T16:38:57Z'
                            submissionId: 4557ecb5-fd32-48cc-81f5-e6acd1099f3c
                            source: customer
                          - deductionFromDate: '2020-05-06'
                            deductionToDate: '2020-06-05'
                            deductionAmount: 355
                            costOfMaterials: 35
                            grossAmountPaid: 1457
                            submissionDate: '2020-05-11T16:38:57Z'
                            source: contractor
                      - fromDate: '2020-04-06'
                        toDate: '2021-04-05'
                        contractorName: Soylent Solutions
                        employerRef: 123/TW44355
                        totalDeductionAmount: 3543.55
                        totalCostOfMaterials: 6644.67
                        totalGrossAmountPaid: 3424.12
                        periodData:
                          - deductionFromDate: '2020-07-06'
                            deductionToDate: '2020-08-05'
                            deductionAmount: 60
                            costOfMaterials: 35
                            grossAmountPaid: 1457
                            submissionDate: '2020-05-11T16:38:57Z'
                            source: contractor
                          - deductionFromDate: '2020-09-06'
                            deductionToDate: '2020-10-05'
                            deductionAmount: 60
                            costOfMaterials: 35
                            grossAmountPaid: 1457
                            submissionDate: '2020-05-11T16:38:57Z'
                            source: contractor
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: &ref_4
                  code:
                    description: The error code
                    type: string
                  message:
                    description: The error message
                    type: string
                required: &ref_5
                  - code
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied NINO field is not valid.
                  value: &ref_9
                    code: FORMAT_NINO
                    message: The provided NINO is invalid
                FORMAT_TAX_YEAR:
                  description: |
                    The format of the supplied tax year field is not valid.
                  value: &ref_29
                    code: FORMAT_TAX_YEAR
                    message: The provided tax year is invalid
                RULE_DATE_RANGE_INVALID:
                  description: |
                    The specified date range is invalid
                  value: &ref_11
                    code: RULE_DATE_RANGE_INVALID
                    message: The date range should be a valid tax year
                RULE_TAX_YEAR_NOT_SUPPORTED:
                  description: |
                    The specified tax year is not supported. Either the tax year specified is before the minimum tax year value,
                    or it is after the maximum tax year value.
                  value: &ref_12
                    code: RULE_TAX_YEAR_NOT_SUPPORTED
                    message: The tax year specified does not lie within the supported range
                RULE_TAX_YEAR_RANGE_INVALID:
                  description: |
                    The specified date range is outside the allowable tax years (the current tax year minus four years).
                  value:
                    code: RULE_TAX_YEAR_RANGE_INVALID
                    message: The specified date range is outside the allowable tax years (the current tax year minus four years)
                RULE_SOURCE_INVALID:
                  description: |
                    The source of data should be one of these All (Blended view), Customer or Contractor.
                  value:
                    code: RULE_SOURCE_INVALID
                    message: The source is invalid
                RULE_INCORRECT_OR_EMPTY_BODY_SUBMITTED:
                  description: |
                    An empty or non-matching body was submitted.
                  value: &ref_10
                    code: RULE_INCORRECT_OR_EMPTY_BODY_SUBMITTED
                    message: An empty or non-matching body was submitted
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for this endpoint version. This error will only be returned in the Sandbox environment.
                  value: &ref_13
                    code: RULE_INCORRECT_GOV_TEST_SCENARIO
                    message: The supplied Gov-Test-Scenario is not valid
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    The client or agent is not authorised. This is because: the client is not subscribed to MTD, the agent is not subscribed to Agent Services, or the client has not authorised the agent to act on their behalf.
                  value: &ref_14
                    code: CLIENT_OR_AGENT_NOT_AUTHORISED
                    message: The client and/or agent is not authorised
        '404':
          description: Not Found
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                MATCHING_RESOURCE_NOT_FOUND:
                  description: |
                    The remote endpoint has indicated that no data can be found for the given period.
                  value: &ref_26
                    code: MATCHING_RESOURCE_NOT_FOUND
                    message: Matching resource not found
  /individuals/deductions/cis/{nino}/amendments:
    post:
      summary: Create CIS Deductions for Subcontractor
      description: |
        This endpoint allows a developer to create a customer’s CIS deductions that have been previously populated. A National Insurance number must be provided.

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario) | Scenario                                                                                                                       |
        |----------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
        | N/A - DEFAULT                    | Simulates success response.                                                                                                    |
        | DEDUCTIONS_DATE_RANGE_INVALID    | Simulates the scenario where the deductions period does not align from the 6th of one month to the 5th of the following month. |
        | UNALIGNED_DEDUCTIONS_PERIOD      | Simulates the scenario where the deductions periods do not align with the tax year supplied.                                   |
        | TAX_YEAR_NOT_ENDED               | Simulates the scenario where the submission is for a tax year that has not ended.                                              |
        | DUPLICATE_SUBMISSION             | Simulates the scenario where CIS deductions already exists for this tax year.                                                  |
        | DUPLICATE_PERIOD                 | Simulates the scenario where CIS deductions already exists for this period.                                                    |
        | OUTSIDE_AMENDMENT_WINDOW         | Simulates the scenario where request cannot be completed as it is outside the amendment window.                                |
        | STATEFUL                         | Performs a stateful create.                                                                                                    |
      parameters:
        - name: nino
          in: path
          description: |
            National Insurance number in the format AA999999A.
          schema: *ref_6
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *write:self-assessment* scope.
          schema: &ref_15
            type: string
            example: Bearer bb7fed3fe10dd235a2ccda3d50fb
          required: true
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_7
          required: true
        - name: Content-Type
          in: header
          description: |
            Specifies the format of the request body, which must be JSON.
          schema: &ref_16
            type: string
            example: application/json
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_8
          required: false
      security:
        - User-Restricted:
            - write:self-assessment
      requestBody:
        content:
          application/json:
            schema:
              $schema: http://json-schema.org/draft-04/schema#
              title: Create CIS Deduction
              description: Create CIS Deduction
              type: object
              properties:
                fromDate:
                  description: CIS tax year start date. The minimum tax year is 2020-21. The minimum tax year in Sandbox is 2019-20.
                  type: string
                  example: '2020-04-06'
                toDate:
                  description: CIS tax year end date. The minimum tax year is 2020-21. The minimum tax year in Sandbox is 2019-20.
                  type: string
                  example: '2021-04-05'
                contractorName:
                  description: The name of the contractor the subcontractor worked for.
                  type: string
                employerRef:
                  description: A unique identifier, the contractor reference number.
                  pattern: ^[0-9]{3}\/[^ ].{0,9}$
                  type: string
                  example: 123/AB56797
                periodData:
                  description: List of deductions. At least one item is required.
                  type: array
                  items:
                    title: item
                    type: object
                    properties:
                      deductionAmount:
                        description: The amount of tax deducted by the contractor. This value must be between 0 and 99999999999.99 up to 2 decimal places.
                        type: number
                        multipleOf: 0.01
                        minimum: 0
                        maximum: 99999999999.99
                        example: '5000.99'
                      deductionFromDate:
                        description: The From date when the deduction was made within the CIS tax year period.
                        type: string
                        example: '2020-07-06'
                      deductionToDate:
                        description: The To date when the deduction was made within the CIS tax year period.
                        type: string
                        example: '2020-08-05'
                      costOfMaterials:
                        description: The cost of materials incurred under CIS. This value must be between 0 and 99999999999.99 up to 2 decimal places.
                        type: number
                        multipleOf: 0.01
                        minimum: 0
                        maximum: 99999999999.99
                        example: '5000.99'
                      grossAmountPaid:
                        description: The gross amount paid under CIS. This value must be between 0 and 99999999999.99 up to 2 decimal places.
                        type: number
                        multipleOf: 0.01
                        minimum: 0
                        maximum: 99999999999.99
                        example: '5000.99'
                    required:
                      - deductionAmount
                      - deductionFromDate
                      - deductionToDate
              required:
                - periodData
                - fromDate
                - toDate
                - contractorName
                - employerRef
            examples:
              example-1:
                description: Create CIS request
                value:
                  fromDate: '2020-04-06'
                  toDate: '2021-04-05'
                  contractorName: ContractorA
                  employerRef: 123/AB56797
                  periodData:
                    - deductionAmount: 355
                      deductionFromDate: '2020-06-06'
                      deductionToDate: '2020-07-05'
                      costOfMaterials: 35
                      grossAmountPaid: 1457
      responses:
        '200':
          description: Success
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                $schema: http://json-schema.org/draft-04/schema#
                title: Create CIS Deduction
                description: Create CIS Deduction
                type: object
                properties:
                  submissionId:
                    description: A unique identifier for the customer provided CIS deduction amendment.
                    type: string
                    pattern: ^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$
                    example: ab123aaa-65ab-488c-9120-f63abc14b9n1
                required:
                  - submissionId
              examples:
                example-user-response:
                  description: Example user response
                  value:
                    submissionId: db854aaa-65dc-488c-9120-e63fea14b9f1
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied NINO field is not valid.
                  value: *ref_9
                RULE_INCORRECT_OR_EMPTY_BODY_SUBMITTED:
                  description: |
                    An empty or non-matching body was submitted.
                  value: *ref_10
                FORMAT_DEDUCTIONS_FROM_DATE:
                  description: |
                    The deductions From date is not a valid date format.
                  value: &ref_17
                    code: FORMAT_DEDUCTIONS_FROM_DATE
                    message: The provided deductions From date is invalid
                FORMAT_DEDUCTIONS_TO_DATE:
                  description: |
                    The deductions To date is not a valid date format.
                  value: &ref_18
                    code: FORMAT_DEDUCTIONS_TO_DATE
                    message: The provided deductions To date is invalid
                FORMAT_EMPLOYER_REFERENCE:
                  description: |
                    The format of the Employer Reference number is invalid.
                  value:
                    code: FORMAT_EMPLOYER_REFERENCE
                    message: The format of the Employer Reference number is invalid
                FORMAT_FROM_DATE:
                  description: |
                    The From date is not a valid format.
                  value:
                    code: FORMAT_FROM_DATE
                    message: The provided From date is invalid
                FORMAT_TO_DATE:
                  description: |
                    The To date is not a valid format.
                  value:
                    code: FORMAT_TO_DATE
                    message: The provided To date is invalid
                RULE_DEDUCTIONS_AMOUNT:
                  description: |
                    The deductions amount should be a positive number less than 99999999999.99 up to 2 decimal places.
                  value: &ref_19
                    code: RULE_DEDUCTIONS_AMOUNT
                    message: The deductions amount should be a positive number less than 99999999999.99 up to 2 decimal places
                RULE_COST_OF_MATERIALS:
                  description: |
                    The cost of materials should be a positive number less than 99999999999.99  up to 2 decimal places.
                  value: &ref_20
                    code: RULE_COST_OF_MATERIALS
                    message: The cost of materials should be a positive number less than 99999999999.99 up to 2 decimal places
                RULE_GROSS_AMOUNT_PAID:
                  description: |
                    The gross amount should be a positive number less than 99999999999.99 up to 2 decimal places.
                  value: &ref_21
                    code: RULE_GROSS_AMOUNT_PAID
                    message: The gross amount should be a positive number less than 99999999999.99 up to 2 decimal places
                RULE_DATE_RANGE_INVALID:
                  description: |
                    The specified date range is invalid
                  value: *ref_11
                RULE_UNALIGNED_DEDUCTIONS_PERIOD:
                  description: |
                    The deductions periods do not align with the tax year supplied.
                  value: &ref_23
                    code: RULE_UNALIGNED_DEDUCTIONS_PERIOD
                    message: The deductions periods do not align with the tax year supplied
                RULE_TAX_YEAR_NOT_SUPPORTED:
                  description: |
                    The specified tax year is not supported. Either the tax year specified is before the minimum tax year value,
                    or it is after the maximum tax year value.
                  value: *ref_12
                RULE_DEDUCTIONS_DATE_RANGE_INVALID:
                  description: |
                    The deductions period does not align from the 6th of one month to the 5th of the following month.
                  value: &ref_22
                    code: RULE_DEDUCTIONS_DATE_RANGE_INVALID
                    message: The deductions period must align from the 6th of one month to the 5th of the following month
                RULE_TAX_YEAR_NOT_ENDED:
                  description: |
                    The submission has been made before the tax year has ended.
                  value:
                    code: RULE_TAX_YEAR_NOT_ENDED
                    message: The submission has been made before the tax year has ended
                RULE_DUPLICATE_SUBMISSION:
                  description: |
                    CIS deductions already exists for this tax year.
                  value:
                    code: RULE_DUPLICATE_SUBMISSION
                    message: CIS deduction already exists for this tax year
                RULE_DUPLICATE_PERIOD:
                  description: |
                    More than one deduction period has been supplied for the same month or period.
                  value: &ref_24
                    code: RULE_DUPLICATE_PERIOD
                    message: More than one deduction period has been supplied for the same month or period
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_13
                RULE_OUTSIDE_AMENDMENT_WINDOW:
                  description: |
                    The request cannot be completed as you are outside the amendment window.
                  value: &ref_25
                    code: RULE_OUTSIDE_AMENDMENT_WINDOW
                    message: You are outside the amendment window
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    The client or agent is not authorised. This is because: the client is not subscribed to MTD, the agent is not subscribed to Agent Services, or the client has not authorised the agent to act on their behalf.
                  value: *ref_14
  /individuals/deductions/cis/{nino}/amendments/{submissionId}:
    put:
      summary: Amend CIS Deductions for Subcontractor
      description: |
        This endpoint allows a developer to amend a customer’s CIS deductions data that has been previously populated. A National Insurance number and submission ID must be provided.

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario) | Scenario                                                                                                                       |
        |----------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
        | N/A - DEFAULT                    | Simulates success response.                                                                                                    |
        | DEDUCTIONS_DATE_RANGE_INVALID    | Simulates the scenario where the deductions period does not align from the 6th of one month to the 5th of the following month. |
        | UNALIGNED_DEDUCTIONS_PERIOD      | Simulates the scenario where the deductions periods do not align with the tax year supplied.                                   |
        | DUPLICATE_PERIOD                 | Simulates the scenario where CIS deductions already exists for this period.                                                    |
        | NOT_FOUND                        | Simulates the scenario where the CIS deduction was not found.                                                                  |
        | TAX_YEAR_NOT_SUPPORTED           | Simulates the scenario where the tax year is not supported.                                                                    |
        | OUTSIDE_AMENDMENT_WINDOW         | Simulates the scenario where request cannot be completed as it is outside the amendment window.                                |
        | STATEFUL                         | Performs a stateful update.                                                                                                    |
      parameters:
        - name: nino
          in: path
          description: |
            National Insurance number in the format AA999999A.
          schema: *ref_6
          required: true
        - name: submissionId
          in: path
          description: |
            A unique identifier for the customer provided CIS deduction amendment.
          schema: &ref_27
            type: string
            example: 4557ecb5-fd32-48cc-81f5-e6acd1099f3c
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *write:self-assessment* scope.
          schema: *ref_15
          required: true
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_7
          required: true
        - name: Content-Type
          in: header
          description: |
            Specifies the format of the request body, which must be JSON.
          schema: *ref_16
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_8
          required: false
      security:
        - User-Restricted:
            - write:self-assessment
      requestBody:
        content:
          application/json:
            schema:
              $schema: http://json-schema.org/draft-04/schema#
              title: |
                Amend CIS Deductions for Subcontractor
              description: This endpoint allows as developer to amend a CIS deductions which has been previously populated
              type: object
              properties:
                periodData:
                  description: List of deductions. At least one item is required.
                  type: array
                  items:
                    type: object
                    properties:
                      deductionAmount:
                        description: The amount of tax deducted by the contractor. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                        type: number
                        example: '5000.99'
                      deductionFromDate:
                        description: The From date when the deduction was made within the CIS tax year period.
                        type: string
                        example: '2020-04-06'
                      deductionToDate:
                        description: The To date when the deduction was made within the CIS tax year period.
                        type: string
                        example: '2020-04-05'
                      costOfMaterials:
                        description: The cost of materials incurred under CIS. This value must be between 0 and 99999999999.99 up to 2 decimal places.
                        type: number
                        example: '5000.99'
                      grossAmountPaid:
                        description: The gross amount paid under CIS. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                        type: number
                        example: '5000.99'
                    required:
                      - deductionAmount
                      - deductionFromDate
                      - deductionToDate
              required:
                - periodData
            examples:
              example-1:
                description: Amend CIS request
                value:
                  periodData:
                    - deductionAmount: 355
                      deductionFromDate: '2020-06-06'
                      deductionToDate: '2020-07-05'
                      costOfMaterials: 35
                      grossAmountPaid: 1457
                    - deductionAmount: 355
                      deductionFromDate: '2020-07-06'
                      deductionToDate: '2020-08-05'
                      costOfMaterials: 35
                      grossAmountPaid: 1457
      responses:
        '204':
          description: No Content
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied NINO field is not valid.
                  value: *ref_9
                RULE_INCORRECT_OR_EMPTY_BODY_SUBMITTED:
                  description: |
                    An empty or non-matching body was submitted.
                  value: *ref_10
                FORMAT_DEDUCTIONS_FROM_DATE:
                  description: |
                    The deductions From date is not a valid date format.
                  value: *ref_17
                FORMAT_DEDUCTIONS_TO_DATE:
                  description: |
                    The deductions To date is not a valid date format.
                  value: *ref_18
                RULE_DEDUCTIONS_AMOUNT:
                  description: |
                    The deductions amount should be a positive number less than 99999999999.99 up to 2 decimal places.
                  value: *ref_19
                RULE_COST_OF_MATERIALS:
                  description: |
                    The cost of materials should be a positive number less than 99999999999.99  up to 2 decimal places.
                  value: *ref_20
                RULE_GROSS_AMOUNT_PAID:
                  description: |
                    The gross amount should be a positive number less than 99999999999.99 up to 2 decimal places.
                  value: *ref_21
                RULE_DEDUCTIONS_DATE_RANGE_INVALID:
                  description: |
                    The deductions period does not align from the 6th of one month to the 5th of the following month.
                  value: *ref_22
                FORMAT_SUBMISSION_ID:
                  description: |
                    The format of the submission ID is not valid.
                  value: &ref_30
                    code: FORMAT_SUBMISSION_ID
                    message: The provided submission ID is invalid
                RULE_UNALIGNED_DEDUCTIONS_PERIOD:
                  description: |
                    The deductions periods do not align with the tax year supplied.
                  value: *ref_23
                RULE_DUPLICATE_PERIOD:
                  description: |
                    More than one deduction period has been supplied for the same month or period.
                  value: *ref_24
                RULE_TAX_YEAR_NOT_SUPPORTED:
                  description: |
                    The specified tax year is not supported. Either the tax year specified is before the minimum tax year value,
                    or it is after the maximum tax year value.
                  value: *ref_12
                RULE_OUTSIDE_AMENDMENT_WINDOW:
                  description: |
                    The request cannot be completed as you are outside the amendment window.
                  value: *ref_25
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_13
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    The client or agent is not authorised. This is because: the client is not subscribed to MTD, the agent is not subscribed to Agent Services, or the client has not authorised the agent to act on their behalf.
                  value: *ref_14
        '404':
          description: Not Found
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                MATCHING_RESOURCE_NOT_FOUND:
                  description: |
                    The remote endpoint has indicated that no data can be found for the given period.
                  value: *ref_26
  /individuals/deductions/cis/{nino}/amendments/{submissionId}/{taxYear}:
    delete:
      summary: Delete CIS Deductions for Subcontractor
      description: "This endpoint allows a developer to remove a customer’s CIS deductions data that has been previously populated. A National Insurance number, submission ID and tax year must be provided.\n\n### Test data\nScenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.\n\n| Header Value (Gov-Test-Scenario) | Scenario                                                                                         |\n|----------------------------------|--------------------------------------------------------------------------------------------------|\n| N/A - DEFAULT                    | Simulates successfully deleting CIS deductions.                                                  |\n| NOT_FOUND                        | Simulates the scenario where the CIS deduction was not found.                                    |\n| TAX_YEAR_NOT_SUPPORTED           | Simulates the scenario where the tax year is not supported.\t                                  |\n| OUTSIDE_AMENDMENT_WINDOW         | Simulates the scenario where request cannot be completed as it is outside the amendment window.  |\n| STATEFUL                         | Performs a stateful delete.                                                                      |\n"
      parameters:
        - name: nino
          in: path
          description: |
            National Insurance number in the format AA999999A.
          schema: *ref_6
          required: true
        - name: submissionId
          in: path
          description: |
            A unique identifier for the customer provided CIS deduction amendment.
          schema: *ref_27
          required: true
        - name: taxYear
          in: path
          description: |
            The tax year the data applies to, for example, 2021-22. The start year and end year must not span two tax years.
          schema: *ref_28
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *write:self-assessment* scope.
          schema: *ref_15
          required: true
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_7
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_8
          required: false
      security:
        - User-Restricted:
            - write:self-assessment
      responses:
        '204':
          description: No Content
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied NINO field is not valid.
                  value: *ref_9
                FORMAT_TAX_YEAR:
                  description: |
                    The format of the supplied tax year field is not valid.
                  value: *ref_29
                FORMAT_SUBMISSION_ID:
                  description: |
                    The format of the submission ID is not valid.
                  value: *ref_30
                RULE_TAX_YEAR_RANGE_EXCEEDED:
                  description: |
                    The tax year range is exceeded.  A tax year range of one year is required.
                  value:
                    code: RULE_TAX_YEAR_RANGE_EXCEEDED
                    message: Tax year range exceeded. A tax year range of one year is required
                RULE_TAX_YEAR_NOT_SUPPORTED:
                  description: |
                    The specified tax year is not supported. Either the tax year specified is before the minimum tax year value,
                    or it is after the maximum tax year value.
                  value: *ref_12
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_13
                RULE_OUTSIDE_AMENDMENT_WINDOW:
                  description: |
                    The request cannot be completed as you are outside the amendment window.
                  value: *ref_25
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    The client or agent is not authorised. This is because: the client is not subscribed to MTD, the agent is not subscribed to Agent Services, or the client has not authorised the agent to act on their behalf.
                  value: *ref_14
        '404':
          description: Not Found
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                MATCHING_RESOURCE_NOT_FOUND:
                  description: |
                    The remote endpoint has indicated that no data can be found for the given period.
                  value: *ref_26
components:
  securitySchemes:
    User-Restricted:
      type: oauth2
      description: HMRC supports OAuth 2.0 for authenticating [User-restricted](https://developer.service.hmrc.gov.uk/api-documentation/docs/authorisation/user-restricted-endpoints) API requests
      flows:
        authorizationCode:
          authorizationUrl: https://api.service.hmrc.gov.uk/oauth/authorize
          tokenUrl: https://api.service.hmrc.gov.uk/oauth/token
          refreshUrl: https://api.service.hmrc.gov.uk/oauth/refresh
          scopes:
            write:self-assessment: Grant write access
            read:self-assessment: Grant read access
